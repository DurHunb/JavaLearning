Editorâ€”â€”Generalâ€”â€”Auto import

Editorâ€”â€”Generalâ€”â€”Code Completion

Editorâ€”â€”File Encoding

Build,Execution,Deploymentâ€”â€”compiler



# ä¸€ã€åŸºæœ¬æ¦‚å¿µ



### ç¨‹åºã€çº¿ç¨‹å’Œè¿›ç¨‹

-  **ç¨‹åº**ï¼šä¸ºå®Œæˆç‰¹å®šä»»åŠ¡ã€ç”¨æŸç§è¯­è¨€ç¼–å†™çš„ä¸€ç»„æŒ‡ä»¤çš„é›†åˆã€‚å³æŒ‡ä¸€æ®µé™æ€çš„ä»£ç ï¼Œé™æ€å¯¹è±¡ã€‚

-  **è¿›ç¨‹**ï¼šç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ–æ˜¯æ­£åœ¨è¿è¡Œä¸­çš„ä¸€ä¸ªç¨‹åº

-  **çº¿ç¨‹**ï¼šï¼ˆè¿›ç¨‹å¯ä»¥è¿›ä¸€æ­¥ç»†åŒ–ä¸ºçº¿ç¨‹ï¼Œï¼‰æ˜¯ç¨‹åºå†…éƒ¨çš„ä¸€æ¡æ‰§è¡Œè·¯å¾„

  - è‹¥ä¸€ä¸ªè¿›ç¨‹åŒä¸€æ—¶é—´å¹¶è¡Œæ‰§è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯æ”¯æŒ **å¤šçº¿ç¨‹** çš„

  - **çº¿ç¨‹**ä½œä¸ºè°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„**è¿è¡Œæ ˆ**å’Œ**ç¨‹åºè®¡æ•°å™¨**ï¼ˆ`pc`ï¼‰ï¼Œçº¿ç¨‹åˆ‡æ¢èŠ±é”€å°

  - <font color="red">ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹å…±äº«ç›¸åŒçš„å†…å­˜å•å…ƒ/å†…å­˜åœ°å€ç©ºé—´ã€‚</font>

    ä»–ä»¬ä»åŒä¸€å †ä¸­åˆ†é…å¯¹è±¡ï¼Œå¯ä»¥è®¿é—®ç›¸åŒçš„å˜é‡å’Œå¯¹è±¡ã€‚



### å•æ ¸/å¤šæ ¸CPU

- **å•æ ¸CPU**ï¼Œå…¶å®æ˜¯å‡çš„å¤šçº¿ç¨‹ã€‚CPUæ˜¯é€šè¿‡æŠŠä¸€ä¸ªçº¿ç¨‹æŒ‚èµ·ï¼Œå†æ‰§è¡Œå…¶ä»–çº¿ç¨‹çš„æ–¹å¼ï¼Œè¾¾åˆ°ä¸€ç§å¤šçº¿ç¨‹çš„æ•ˆæœã€‚å› ä¸ºCPUçš„æ—¶é—´å•å…ƒéå¸¸çŸ­ï¼Œæ‰€ä»¥æ„Ÿè§‰ä¸å‡ºæ¥

- **å¤šæ ¸CPU**ï¼Œæ›´å¥½çš„å‘æŒ¥å¤šçº¿ç¨‹çš„æ•ˆç‡ï¼Œç°åœ¨æœåŠ¡å™¨éƒ½æ˜¯å¤šçº¿ç¨‹çš„ã€‚

  

  ä¸€ä¸ªJavaåº”ç”¨ç¨‹åº`Java.exe`ï¼Œè‡³å°‘æœ‰ä¸‰ä¸ªçº¿ç¨‹ï¼š`main()`ä¸»çº¿ç¨‹ï¼Œ`gc()`åƒåœ¾å›æ”¶çº¿ç¨‹ï¼Œå¼‚å¸¸å¤„ç†çº¿ç¨‹ã€‚



### å¹¶è¡Œ/å¹¶å‘

- **å¹¶è¡Œ**ï¼Œå¤šä¸ªCPUåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚
- **å¹¶å‘**ï¼Œä¸€ä¸ªCPUï¼ˆé‡‡ç”¨æ—¶é—´ç‰‡ï¼‰åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚



### å¤šçº¿ç¨‹çš„ä¼˜ç‚¹

- æé«˜åº”ç”¨ç¨‹åºçš„å“åº”ã€‚å¯¹å›¾å½¢åŒ–ç•Œé¢æ›´æœ‰æ„ä¹‰ï¼Œå¯å¢å¼ºç”¨æˆ·ä½“éªŒ
- æé«˜è®¡ç®—æœºç³»ç»ŸCPUçš„åˆ©ç”¨ç‡
- æ”¹å–„ç¨‹åºç»“æ„ã€‚å°†æ—¢é•¿åˆå¤æ‚çš„è¿›ç¨‹åˆ†è§£ä¸ºå¤šä¸ªçº¿ç¨‹ï¼Œç‹¬ç«‹è¿è¡Œï¼Œä¾¿äºç†è§£å’Œä¿®æ”¹



### ä½•æ—¶éœ€è¦å¤šçº¿ç¨‹

- ç¨‹åºéœ€è¦åŒæ—¶æ‰§è¡Œä¸¤ä¸ªæˆ–å¤šä¸ªä»»åŠ¡
- ç¨‹åºéœ€è¦å®ç°ä¸€äº›éœ€è¦ç­‰å¾…çš„ä»»åŠ¡ï¼Œå¦‚ç”¨æˆ·è¾“å…¥ã€æ–‡ä»¶è¯»å†™ã€ç½‘ç»œæ“ä½œã€æœç´¢ç­‰
- éœ€è¦ä¸€äº›åœ¨åå°è¿è¡Œçš„ç¨‹åºæ—¶





# äºŒã€çº¿ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨



> Javaè¯­è¨€çš„`JVM`å…è®¸ç¨‹åºè¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œé€šè¿‡`java.lang.Thread`ç±»æ¥ä½“ç°



## 1ã€å¤šçº¿ç¨‹çš„åˆ›å»º-æ–¹å¼ä¸€



**æ–¹å¼ä¸€ï¼šç»§æ‰¿`Thread`ç±»**

1. åˆ›å»ºä¸€ä¸ªç»§æ‰¿äº`Thread`ç±»çš„å­ç±»

2. é‡å†™`Thread`ç±»çš„`run()`

   å°†æ­¤çº¿ç¨‹è¦æ‰§è¡Œçš„æ“ä½œå£°æ˜åœ¨`run()`ä¸­

3. åˆ›å»º`Thread`ç±»çš„å­ç±»çš„å¯¹è±¡

4. é€šè¿‡æ­¤å¯¹è±¡è°ƒç”¨`start()`



- å¦‚æœçº¿ç¨‹ä»…ä½¿ç”¨ä¸€æ¬¡ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºåŒ¿åå­ç±»çš„æ–¹å¼



**æ³¨æ„äº‹é¡¹**ï¼š

1. ä¸èƒ½é€šè¿‡è°ƒç”¨`run()`çš„æ–¹å¼å¯åŠ¨çº¿ç¨‹ï¼Œå¿…é¡»è°ƒç”¨`start()`

2. å·²ç»`start()`çš„çº¿ç¨‹ ï¼Œä¸èƒ½å†`start()`æ‰§è¡Œï¼Œä¼šæŠ¥å¼‚å¸¸

   å¦‚æœè¦å†æ­¤æ‰§è¡Œè¯¥çº¿ç¨‹ï¼Œéœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œå†è°ƒç”¨`start()`

   ```java
   //å†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œéå†100ä»¥å†…çš„å¶æ•°
   MyThread t2 = new MyThread();
   t2.start();
   ```

   

```java
public class ThreadTest {
    public static void main(String[] args) {
        //3.åˆ›å»ºå­ç±»çš„å¯¹è±¡
        MyThread t1 = new MyThread();
        
        //4.é€šè¿‡æ­¤å¯¹è±¡è°ƒç”¨run();â‘ å¯åŠ¨å½“å‰çº¿ç¨‹ â‘¡è°ƒç”¨å½“å‰çº¿ç¨‹çš„run()
        t1.start();
		
        //å¦‚ä¸‹æ“ä½œåœ¨mainçº¿ç¨‹ä¸­æ‰§è¡Œ
        for(int i=0;i<10;i++){
            System.out.println(Thread.currentThread().getName()+":"+i+"hello");
        }
    }
}

//1.åˆ›å»ºä¸€ä¸ªç»§æ‰¿äº`Thread`ç±»çš„å­ç±»
class MyThread extends Thread {

    //2.é‡å†™`Thread`ç±»çš„`run()`
    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            if (i % 2 == 0) {
                System.out.println(Thread.currentThread().getName()+":"+i);
            }
        }
    }
}
```

```java
//åˆ›å»ºåŒ¿åå­ç±»çš„æ–¹å¼
new Thread(){
    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            if (i % 2 == 0) {
                System.out.println(Thread.currentThread().getName()+":"+i);
            }
        }
    }
}.start();
```





## 2ã€`Thread`ç±»çš„æ–¹æ³•

- `void start();`ï¼Œå¯åŠ¨çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œå¯¹è±¡çš„run()æ–¹æ³•

- `void run();`ï¼Œçº¿ç¨‹åœ¨è¢«è°ƒåº¦æ—¶æ‰§è¡Œçš„æ“ä½œ

- `String getName();`ï¼Œè¿”å›çº¿ç¨‹çš„åç§°

- 1. `void setName(String Name);`ï¼Œè®¾ç½®è¯¥çº¿ç¨‹çš„åç§°

  2. Threadç±»æä¾›æ„é€ å™¨`Thread(String Name)`ï¼Œé€šè¿‡æ„é€ å™¨çš„æ–¹å¼è¿›è¡Œå‘½å

- `static Thread currentThread();`ï¼Œè¿”å›å½“å‰çº¿ç¨‹ã€‚åœ¨Threadå­ç±»ä¸­å°±æ˜¯thisï¼Œ

- `yield();`ï¼Œé‡Šæ”¾å½“å‰çº¿ç¨‹ã€‚ä½†æ˜¯ä¸‹ä¸€åˆ»å½“å‰çº¿ç¨‹è¿˜æœ‰å¯èƒ½è¢«åˆ†é…åˆ°CPU

- `join();`ï¼Œ

  åœ¨çº¿ç¨‹aä¸­è°ƒç”¨çº¿ç¨‹bçš„join(),æ­¤æ—¶çº¿ç¨‹aå°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°çº¿ç¨‹bå®Œå…¨æ‰§è¡Œå®Œï¼Œçº¿ç¨‹aæ‰ç»“æŸé˜»å¡çŠ¶æ€

- `sleep(long millitime)`ï¼Œè®©å½“å‰çº¿ç¨‹ç¡çœ æŒ‡å®šæ¯«ç§’æ•°ï¼Œ1000æ¯«ç§’=1ç§’

- `isAlive();`ï¼Œåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å­˜æ´»





```java
public class ThreadTest {
    public static void main(String[] args) {

        MyThread t1 = new MyThread("çº¿ç¨‹1111");
        t1.start();

        //ç»™çº¿ç¨‹å‘½å
        t1.setName("çº¿ç¨‹ä¸€");
        //ç»™ä¸»çº¿ç¨‹å‘½å
        Thread.currentThread().setName("ä¸»çº¿ç¨‹");

        for(int i=0;i<100;i++){
            if (i % 2 == 0) {
                System.out.println(Thread.currentThread().getName()+":"+i);
            }
            if (i==20){
                try {
                    //åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œè°ƒç”¨çº¿ç¨‹ä¸€çš„join()
                    t1.join();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }
        //åˆ¤æ–­çº¿ç¨‹ä¸€æ˜¯å¦è¿˜å­˜æ´»
        System.out.println(t1.isAlive());
    }
}


class MyThread extends Thread {

    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            if (i % 2 == 0) {
                System.out.println(Thread.currentThread().getName()+":"+i);
            }

            try {
                sleep(10);//å•ä½ï¼šæ¯«ç§’//å¯ä»¥æŠŠæ—¶é—´è®¾é•¿ä¸€ç‚¹æ›´æ˜æ˜¾
            } catch (InterruptedException e) {
                e.printStackTrace();
            }

            if (i % 20 ==0) {
                //é‡Šæ”¾å½“å‰çº¿ç¨‹
                yield();
                //ä½†ä¸‹ä¸€åˆ»å¯èƒ½è¿˜ä¼šè¢«åˆ†é…åˆ°å½“å‰çº¿ç¨‹
            }
        }
    }

    public MyThread(String Name){
        super(Name);
    }
}
```





## 3ã€çº¿ç¨‹çš„è°ƒåº¦



**è°ƒåº¦ç­–ç•¥ï¼š**

- æ—¶é—´ç‰‡ï¼š
- æŠ¢å å¼ï¼š<font color='red'>é«˜ä¼˜å…ˆçº§</font>çš„çº¿ç¨‹æŠ¢å CPU

**Javaçš„è°ƒåº¦æ–¹æ³•ï¼š**

- åŒä¼˜å…ˆçº§çº¿ç¨‹ç»„æˆå…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œä½¿ç”¨æ—¶é—´ç‰‡ç­–ç•¥
- å¯¹äºé«˜ä¼˜å…ˆçº§ï¼Œä½¿ç”¨ä¼˜å…ˆè°ƒåº¦çš„æŠ¢å å¼ç­–ç•¥



### çº¿ç¨‹çš„ä¼˜å…ˆçº§



**çº¿ç¨‹çš„ä¼˜å…ˆçº§ç­‰çº§ï¼š**

- `MAX_PRIORITY`ï¼š10
- `MIN_PRIORITY`ï¼š1
- `NORM_PRIORITY`ï¼š5

**æ¶‰åŠçš„æ–¹æ³•ï¼š**

- `getPriority`ï¼šè¿”å›çº¿ç¨‹ä¼˜å…ˆçº§
- `setPriority(int newPriority)`ï¼šæ”¹å˜çº¿ç¨‹çš„ä¼˜å…ˆçº§

**æ³¨æ„ï¼š**

- çº¿ç¨‹åˆ›å»ºæ—¶ï¼Œç»§æ‰¿çˆ¶çº¿ç¨‹çš„ä¼˜å…ˆçº§
- ä½ä¼˜å…ˆçº§åªæ˜¯è·å¾—è°ƒåº¦çš„æ¦‚ç‡ä½ï¼Œå¹¶éä¸€å®šæ˜¯åœ¨é«˜ä¼˜å…ˆçº§ä¹‹åæ‰è¢«è°ƒç”¨



```java
Thread.currentThread().getPriority();
Thread.currentThread().setPriority(1);
t1.setPriority(MIN_PRIORITY);
t1.setPriority(MAX_PRIORITY);
```





## 4ã€å¤šçº¿ç¨‹çš„åˆ›å»º-æ–¹å¼äºŒ



**æ–¹å¼äºŒï¼šå®ç°`Runnable`æ¥å£**

1. åˆ›å»ºä¸€ä¸ªå®ç°äº†`Runnable`æ¥å£çš„ç±»
2. å®ç°ç±»å»å®ç°`Runnable`çš„æŠ½è±¡æ–¹æ³•ï¼š`run()`
3. åˆ›å»ºå®ç°ç±»çš„å¯¹è±¡
4. å°†æ­¤å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä¼ é€’åˆ°`Thread`ç±»çš„æ„é€ å™¨ä¸­ï¼Œåˆ›é€ `Thread`ç±»çš„å¯¹è±¡
5. é€šè¿‡`Thread`ç±»çš„å¯¹è±¡è°ƒç”¨`start()`



```java
public class RunnableTest {
    public static void main(String[] args) {
        //3.åˆ›å»ºå®ç°ç±»çš„å¯¹è±¡
        MyRunnableThread mThread = new MyRunnableThread();
        //4.å°†æ­¤å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä¼ é€’åˆ°`Thread`ç±»çš„æ„é€ å™¨ä¸­ï¼Œåˆ›é€ `Thread`ç±»çš„å¯¹è±¡
        Thread t1 = new Thread(mThread);
        Thread t2 = new Thread(mThread);//ä¸¤ä¸ªçº¿ç¨‹å…±ç”¨ä¸€ä¸ªå¯¹è±¡
        //5.é€šè¿‡`Thread`ç±»çš„å¯¹è±¡è°ƒç”¨`start()`
        t1.start();
    }

}

//1.åˆ›å»ºä¸€ä¸ªå®ç°äº†`Runnable`æ¥å£çš„ç±»
class MyRunnableThread implements Runnable{

    //2.å®ç°ç±»å»å®ç°`Runnable`çš„æŠ½è±¡æ–¹æ³•ï¼š`run()`
    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            if (i % 2 == 0) {
                System.out.println(Thread.currentThread().getName() + ":" + i);
            }
        }
    }
}
```





## 5ã€æ–¹å¼ä¸€å’Œæ–¹å¼äºŒçš„æ¯”è¾ƒ



**å¼€å‘ä¸­ä¼˜å…ˆé€‰æ‹©ä½¿ç”¨Runnableçš„æ–¹å¼**

åŸå› ï¼š

- å®ç°çš„æ–¹å¼æ²¡æœ‰ç±»çš„å•ç»§æ‰¿çš„å±€é™æ€§
- å®ç°çš„æ–¹å¼æ›´é€‚åˆå¤„ç†å¤šä¸ªçº¿ç¨‹å…±ç”¨æ•°æ®çš„æƒ…å†µ



è”ç³»ï¼šThreadç±»ä¹Ÿå®ç°äº†Runnable

```java
public class Thread implements Runnable
```

ç›¸åŒç‚¹ï¼šä¸¤ç§æ–¹æ³•éƒ½è¦é‡å†™`run()`ï¼Œå°†çº¿ç¨‹è¦æ‰§è¡Œçš„é€»è¾‘å£°æ˜åœ¨`run()`ä¸­



## 6ã€å¤šçº¿ç¨‹çš„åˆ›å»º-æ–¹å¼ä¸‰



**æ–¹å¼ä¸‰ï¼šå®ç°Callableæ¥å£**



> JDK5.0æ–°å¢
>
> è¦ä½¿ç”¨Callableï¼Œéœ€è¦å€ŸåŠ©FutureTaskç±»



- å¦‚ä½•ç†è§£Callableæ¯”Runnableå¼ºå¤§
  - ç›¸æ¯”run()æ–¹æ³•ï¼Œcall()æ–¹æ³•å¯ä»¥æœ‰è¿”å›å€¼
  - call()æ–¹æ³•å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¢«å¤–é¢çš„æ“ä½œæ•è·ï¼Œè·å–å¼‚å¸¸ä¿¡æ¯
  - Callableæ”¯æŒæ³›å‹çš„è¿”å›å€¼

- Futureæ¥å£

  - å¯ä»¥å¯¹å…·ä½“Runnableã€Callableæ¥å£ä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿›è¡Œå–æ¶ˆã€æŸ¥è¯¢æ˜¯å¦å®Œæˆã€è·å–ç»“æœç­‰ã€‚
  - FutureTaskæ˜¯Futureæ¥å£çš„å”¯ä¸€çš„å®ç°ç±»
  - FutureTaskåŒæ—¶å®ç°äº†Runnableã€Futureæ¥å£ã€‚å®ƒæ—¢å¯ä»¥ä½œä¸ºRunnableè¢«çº¿ç¨‹æ‰§è¡Œï¼Œåˆå¯ä»¥ä½œä¸ºFutureCallable

  



```java
package day_07;

import java.util.concurrent.Callable;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.FutureTask;

/**
 * @version:
 * @Auther: ä»»åš
 * @Date: 2021/03/11/16:02
 * @Description:
 */

public class CallableTest {
    public static void main(String[] args) {
        //3.åˆ›å»ºCallableæ¥å£å®ç°ç±»çš„å¯¹è±¡
        NumThread numThread = new NumThread();
        //4.å°†å®ç°ç±»çš„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°FutureTaskçš„æ„é€ å™¨ä¸­ï¼Œåˆ›é€ FutureTaskå¯¹è±¡
        FutureTask futureTask = new FutureTask(numThread);
        //5.å°†FutureTaskå¯¹è±¡ä¼ é€’åˆ°Threadç±»çš„æ„é€ å™¨ä¸­ï¼Œåˆ›å»ºThreadå¯¹è±¡ï¼Œå¹¶è°ƒç”¨start()
        // å¯åŠ¨çº¿ç¨‹ï¼Œä¸å†™çš„è¯çº¿ç¨‹ä¸å¯åŠ¨
        new Thread(futureTask).start();

        try {
            //6.è·å¾—Callæ–¹æ³•çš„è¿”å›å€¼(å¯é€‰)
            //get()è¿”å›å€¼å³ä¸ºFutureTaskæ„é€ å™¨å‚æ•°Callableï¼Œçš„å®ç°ç±»é‡å†™çš„call()çš„è¿”å›å€¼
            Object sum = futureTask.get();
            System.out.println(sum);
        } catch (InterruptedException e) {
            e.printStackTrace();
        } catch (ExecutionException e) {
            e.printStackTrace();
        }
    }

}
//1.åˆ›å»ºå®ç°Callableçš„å®ç°ç±»
class NumThread implements Callable {

    //2.å®ç°callæ–¹æ³•ï¼Œå°†çº¿ç¨‹è¦æ‰§è¡Œçš„æ“ä½œå£°æ˜åœ¨call()ä¸­
    @Override
    public Object call() throws Exception {
        //éå†100ä»¥å†…çš„å¶æ•°ï¼Œå¹¶è¿”å›å€¼
        int sum = 0;
        for (int i = 0; i <= 100; i++) {
            if (i % 2 == 0) {
                System.out.println(i);
                sum += i;
            }
        }
        return sum;
//        return null;
    }
}
```















## 7ã€å¤šçº¿ç¨‹çš„åˆ›å»º-æ–¹å¼å››ã€å¸¸ç”¨ã€‘

> èƒŒæ™¯ï¼šç»å¸¸åˆ›å»ºå’Œé”€æ¯ã€ä½¿ç”¨é‡ç‰¹åˆ«å¤§çš„èµ„æºï¼Œæ¯”å¦‚å¹¶å‘æƒ…å†µä¸‹çš„çº¿ç¨‹ï¼Œå¯¹æ€§èƒ½å½±å“å¾ˆå¤§ã€‚
>
> æ€è·¯ï¼šæå‰åˆ›å»ºå¥½å¤šä¸ªçº¿ç¨‹ï¼Œæ”¾å…¥çº¿ç¨‹æ± ä¸­ï¼Œä½¿ç”¨æ—¶ç›´æ¥è·å–ï¼Œä½¿ç”¨å®Œæ”¾å›æ± ä¸­ã€‚å¯ä»¥é¿å…é¢‘ç¹åˆ›å»ºé”€æ¯ï¼Œå®ç°é‡å¤åˆ©ç”¨
>
> å¥½å¤„ï¼š
>
> - æé«˜äº†å“åº”é€Ÿåº¦ï¼ˆå‡å°‘äº†çº¿ç¨‹åˆ›å»ºçš„æ—¶é—´ï¼‰
> - é™ä½èµ„æºæ¶ˆè€—ï¼ˆé‡å¤åˆ©ç”¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½åˆ›å»ºï¼‰
> - ä¾¿äºçº¿ç¨‹ç®¡ç†
>   - corePoolSizeï¼šæ ¸å¿ƒæ± å¤§å°
>   - maxmumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°
>   - ...

**æ–¹å¼å››ï¼šä½¿ç”¨çº¿ç¨‹æ± **

- JDKæä¾›äº†çº¿ç¨‹æ± ç›¸å…³çš„APIï¼š **Executors**å’Œ**ExecutorService**
- **ExecutorService**ï¼šçœŸæ­£çš„çº¿ç¨‹æ± æ¥å£ã€‚å¸¸è§å­ç±»ThreadPoolExecutor

```java
//æ‰§è¡Œä»»åŠ¡/å‘½ä»¤ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œä¸€èˆ¬ç”¨æ¥æ‰§è¡ŒRunnable    
void execute(Runnable command)

//æ‰§è¡Œä»»åŠ¡ï¼Œæœ‰è¿”å›å€¼ï¼Œä¸€èˆ¬ç”¨æ¥æ‰§è¡ŒCallable     
<T>Future<T>submit(Callable<T> task)

//å…³é—­è¿æ¥æ± 
void shutdown()
```

-  **Executors**

```java
//åˆ›å»ºä¸€ä¸ªå¯æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± 
Executors.newCashedThreadPool();
//åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± 
Executors.newFixedThreadPool(n);
//åˆ›å»ºä¸€ä¸ªåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ•°
Executors.newSingleThreadExecutor();
//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå®ƒå¯å®‰æ’åœ¨ç»™å®šå»¶è¿Ÿåè¿è¡Œå‘½ä»¤æˆ–è€…å®šæœŸæ‰§è¡Œ
Executors.newScheduledThreadPool(n);
```







```java
package day_07;

import java.util.concurrent.*;

/**
 * @version:
 * @Auther: ä»»åš
 * @Date: 2021/03/12/15:02
 * @Description:
 */

class NumberThread1 implements Runnable{
    @Override
    public void run() {
        for (int i=0;i <= 100 ; i++){
            if (i%2==0){
                System.out.println(Thread.currentThread().getName()+':'+i);

            }
        }
    }
}
class NumberThread2 implements Runnable{
    @Override
    public void run() {
        for (int i=0;i <= 100 ; i++){
            if (i%2!=0){
                System.out.println(Thread.currentThread().getName()+':'+i);
            }
        }
    }
}

class NumberThread3 implements Callable {

    @Override
    public Object call() throws Exception {
        int sum =0;
        for (int i=0;i <= 100 ; i++){
            if (i%2!=0){
                sum+=i;
            }
        }
        return sum;
    }
}

public class ThreadPool {
    public static void main(String[] args) {

        //1.æä¾›æŒ‡å®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± 
        ExecutorService service = Executors.newFixedThreadPool(10);
		
        //è®¾ç½®çº¿ç¨‹æ± çš„å±æ€§
        //æ¥å£æ²¡æœ‰å¤šå°‘å±æ€§ï¼Œéœ€è¦é€šè¿‡ç±»æ¥æ“ä½œ
        ThreadPoolExecutor service1 = (ThreadPoolExecutor) service;
        service1.setCorePoolSize(15);
        
        //2.æ‰§è¡ŒæŒ‡å®šçº¿ç¨‹çš„æ“ä½œã€‚éœ€è¦æä¾›å®ç°Runnableæˆ–Callableæ¥å£å®ç°ç±»çš„å¯¹è±¡
        service.execute(new NumberThread1());//é€‚ç”¨äºRunnable
        service.execute(new NumberThread2());//é€‚ç”¨äºRunnable


        Future submit = service.submit(new NumberThread3());//é€‚ç”¨äºCallable

        try {
            int sum = (Integer) submit.get();
            System.out.println(sum);
        } catch (InterruptedException e) {
            e.printStackTrace();
        } catch (ExecutionException e) {
            e.printStackTrace();
        }


        //3.å…³é—­è¿æ¥æ± 
        service.shutdown();
    }
}

```

















# ä¸‰ã€çº¿ç¨‹å®‰å…¨



## 1ã€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ

åœ¨ä¸€ä¸ªå®Œæ•´çš„å£°æ˜å‘¨æœŸä¸­ï¼Œé€šå¸¸è¦ç»å†å¦‚ä¸‹äº”ç§çŠ¶æ€

- æ–°å»ºï¼šå½“ä¸€ä¸ª`Thread`ç±»æˆ–å…¶å­ç±»è¢«å£°æ˜å¹¶åˆ›å»ºæ—¶ï¼Œæ–°ç”Ÿçš„çº¿ç¨‹å¯¹è±¡å¤„äºæ–°å»ºçŠ¶æ€
- å°±ç»ªï¼šå¤„äºæ–°å»ºçŠ¶æ€çš„çº¿ç¨‹è¢«`start()`åï¼Œå°†è¿›å…¥çº¿ç¨‹åºåˆ—ç­‰å¾…CPUæ—¶é—´ç‰‡ï¼Œæ­¤æ—¶å®ƒå·²ç»å…·å¤‡äº†è¿è¡Œçš„æ¡ä»¶ï¼Œåªæ˜¯æ²¡æœ‰åˆ†é…åˆ°CPUèµ„æº
- è¿è¡Œï¼šå½“å°±ç»ªçš„çº¿ç¨‹è¢«è°ƒç”¨å¹¶è·å¾—CPUèµ„æºæ—¶ï¼Œä¾¿è¿›å…¥è¿è¡ŒçŠ¶æ€ï¼Œ`run`æ–¹æ³•å®šä¹‰äº†çº¿ç¨‹çš„æ“ä½œå’ŒåŠŸèƒ½
- é˜»å¡ï¼šåœ¨æŸç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¢«äººä¸ºæŒ‚èµ·æˆ–æ‰§è¡Œè¾“å…¥è¾“å‡ºæ“ä½œæ—¶ï¼Œè®©å‡ºCPUå¹¶ä¸´æ—¶ä¸­æ­¢è‡ªå·±çš„è¿è¡Œï¼Œè¿›å…¥é˜»å¡çŠ¶æ€
- æ­»äº¡ï¼šçº¿ç¨‹å®Œæˆäº†å®ƒå…¨éƒ¨å·¥ä½œï¼Œæˆ–çº¿ç¨‹è¢«æå‰å¼ºåˆ¶æ€§ä¸­æ­¢ï¼Œæˆ–å‡ºç°å¼‚å¸¸å¯¼è‡´ç»“æŸ



![image-20210107144223438](D:\ForLife\Learning\Java\å¤šçº¿ç¨‹.assets\image-20210107144223438.png)

## 2ã€å¤„ç†çº¿ç¨‹å®‰å…¨

> åŒæ­¥çš„æ–¹å¼ï¼Œè§£å†³äº†çº¿ç¨‹å®‰å…¨é—®é¢˜-----â†’å¥½å¤„
>
> æ“ä½œåŒæ­¥ä»£ç æ—¶ï¼Œåªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹å‚ä¸ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚ç›¸å½“äºä¸€ä¸ªå•çº¿ç¨‹ä»»åŠ¡ï¼Œæ•ˆç‡ä½----â†’å±€é™æ€§

```java
/**
 * ä¾‹å­ï¼šåˆ›å»ºä¸‰ä¸ªçª—å£å–ç¥¨ï¼Œæ€»ç¥¨æ•°ä¸º100å¼ ï¼Œä½¿ç”¨å®ç°runnableæ¥å£çš„æ–¹å¼
 * 1ã€é—®é¢˜ï¼šå–ç¥¨è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†é‡ç¥¨ã€é”™ç¥¨-------â†’çº¿ç¨‹å®‰å…¨é—®é¢˜
 * 2ã€é—®é¢˜å‡ºç°çš„åŸå› ï¼šå½“æŸä¸ªçº¿ç¨‹æ“ä½œè½¦ç¥¨æ—¶ï¼Œæ“ä½œå°šæœªå®Œæˆï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿå‚ä¸è¿›æ¥æ“ä½œè½¦ç¥¨
 * 3ã€è§£å†³æ–¹å¼ï¼šå½“ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½å‚ä¸è¿›æ¥
 * 4ã€åœ¨Javaä¸­ï¼Œé€šè¿‡åŒæ­¥æœºåˆ¶ï¼Œæ¥è§£å†³çº¿ç¨‹çš„å®‰å…¨é—®é¢˜
 *
 * æ–¹å¼ä¸€ï¼šåŒæ­¥ä»£ç å—
 *   synchronized(åŒæ­¥ç›‘è§†å™¨){
 *       //éœ€è¦è¢«åŒæ­¥çš„ä»£ç 
 *   }
 * 
 * æ–¹å¼äºŒï¼šåŒæ­¥æ–¹æ³•
 *private synchronized void show(){}       runnableæ–¹å¼
 *private static synchronized void show(){}     ç»§æ‰¿Threadç±»
 *
 */
public class WindowRunnable {
    public static void main(String[] args) {
        Window w = new Window();
        Thread t1 = new Thread(w);
        Thread t2 = new Thread(w);
        Thread t3 = new Thread(w);

        t1.setName("çª—å£1");
        t2.setName("çª—å£2");
        t3.setName("çª—å£3");

        t1.start();
        t2.start();
        t3.start();
    }
}
class Window implements Runnable{
    private  int ticket = 100;
    @Override
    public void run() {
        while(true){
            if(ticket>0){
//                try {
//                    Thread.sleep(100);
//                } catch (InterruptedException e) {
//                    e.printStackTrace();
//                }
                System.out.println(
                    Thread.currentThread().getName()+"å–ç¥¨ï¼šç¥¨å·ä¸º"+ticket);
                ticket--;
            }else {
                break;
            }
        }
    }
}
```



```java
/**
 * ä¾‹å­ï¼šåˆ›å»ºä¸‰ä¸ªçª—å£å–ç¥¨ï¼Œæ€»ç¥¨æ•°ä¸º100å¼ ï¼Œä½¿ç”¨ç»§æ‰¿Threadç±»çš„æ–¹å¼
 */
public class WindowThread {
    public static void main(String[] args) {
        Window2 w1 = new Window2();
        Window2 w2 = new Window2();
        Window2 w3 = new Window2();

        w1.setName("çª—å£1");
        w2.setName("çª—å£2");
        w3.setName("çª—å£3");

        w1.start();
        w2.start();
        w3.start();
    }
}

class Window2 extends Thread {
    private static int ticket = 100;

    @Override
    public void run() {
        while (true) {
            if (ticket > 0) {
                System.out.println(
                    Thread.currentThread().getName() + "å–ç¥¨ï¼šç¥¨å·ä¸º" + ticket);
                ticket--;
            } else {
                break;
            }
        }
    }
}
```









### æ–¹å¼ä¸€ï¼šåŒæ­¥ä»£ç å—

```java
synchronized(åŒæ­¥ç›‘è§†å™¨){
     //éœ€è¦è¢«åŒæ­¥çš„ä»£ç ã€ä¸èƒ½åŒ…å¤šï¼ˆè­¦æƒ•å˜æˆå•çº¿ç¨‹ï¼‰ï¼Œä¹Ÿä¸èƒ½åŒ…å°‘ã€‘
}
```

è¯´æ˜ï¼š

- æ“ä½œå…±äº«æ•°æ®çš„ä»£ç ï¼Œå³ä¸ºéœ€è¦è¢«åŒæ­¥çš„ä»£ç 
- å…±äº«æ•°æ®æŒ‡å¤šä¸ªçº¿ç¨‹å…±åŒæ“ä½œçš„å˜é‡ï¼Œæ¯”å¦‚ticket
- åŒæ­¥ç›‘è§†å™¨ï¼Œä¿—ç§°â€œé”â€ã€‚ä»»ä½•ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥å……å½“é”
   *         è¦æ±‚ï¼šå¤šä¸ªçº¿ç¨‹å¿…é¡» **<font color='red'>åŒä¸€æŠŠé”</font>**ï¼Œé”åªèƒ½æœ‰ä¸€ä¸ªã€‚ **å³å¯¹è±¡å¿…é¡»æ˜¯åŒä¸€ä¸ª**

```java
//åŒæ­¥ä»£ç å—ï¼Œå¤„ç†å®ç°Runnableæ¥å£çš„æ–¹å¼çš„çº¿ç¨‹å®‰å…¨é—®é¢˜
class Window implements Runnable{

    private  int ticket = 100;
    //åŒä¸€æŠŠé”ï¼Œå› ä¸ºmainæ–¹æ³•é‡Œåªnewäº†ä¸€ä¸ªå¯¹è±¡ã€‚
    Object obj = new Object();
    
    @Override
    public void run() {
        //Object obj = new Object();//å¦‚æœåœ¨è¿™é‡Œåˆ›å»ºï¼Œå°±æ˜¯ä¸å®‰å…¨çš„ï¼Œä¸æ˜¯åŒä¸€æŠŠé”
        while(true){
            //å¯ä»¥ç”¨thisä»£æ›¿objï¼Œè¡¨ç¤ºå”¯ä¸€çš„windowå¯¹è±¡ï¼Œä¸ç”¨å†new object
            synchronized (obj) {
                if (ticket > 0) {
                    System.out.println(
                        Thread.currentThread().getName() + "å–ç¥¨ï¼šç¥¨å·ä¸º" + ticket);
                    ticket--;
                } else {
                    break;
                }
            }
        }
    }
}
```



```java
//åŒæ­¥ä»£ç å—ï¼Œå¤„ç†ä½¿ç”¨ç»§æ‰¿Threadç±»çš„æ–¹å¼çš„çº¿ç¨‹å®‰å…¨é—®é¢˜
class Window2 extends Thread {
    private static int ticket = 100;
    private static Object obj = new Object();//ä¸Runnableç›¸æ¯”ï¼Œå¤šäº†static

    @Override
    public void run() {
        while (true) {
            //è¿™é‡Œä¸èƒ½ç”¨thisä»£æ›¿objï¼Œ
            //å¯ä»¥ç”¨window2.classä»£æ›¿objï¼Œwindow2.classåªåŠ è½½ä¸€æ¬¡ï¼Œæ˜¯å”¯ä¸€çš„
            //ã€ç±»ä¹Ÿæ˜¯å¯¹è±¡ï¼Ÿæ¶‰åŠåˆ°åå°„çŸ¥è¯†ã€‘
            synchronized(obj) {
                if (ticket > 0) {
                    System.out.println(
                        Thread.currentThread().getName() + "å–ç¥¨ï¼šç¥¨å·ä¸º" + ticket);
                    ticket--;
                } else {
                    break;
                }
            }
        }
    }
}
```



### æ–¹å¼äºŒï¼šåŒæ­¥æ–¹æ³•

å…³äºåŒæ­¥æ–¹æ³•æ€»ç»“

- åŒæ­¥æ–¹æ³•ä»ç„¶æ¶‰åŠåˆ°åŒæ­¥ç›‘è§†å™¨ï¼Œåªæ˜¯ä¸éœ€è¦æˆ‘ä»¬æ˜¾ç¤ºçš„å£°æ˜

- éé™æ€çš„åŒæ­¥æ–¹æ³•ï¼ŒåŒæ­¥ç›‘è§†å™¨æ˜¯ï¼š`this`

  é™æ€çš„åŒæ­¥æ–¹æ³•ï¼ŒåŒæ­¥ç›‘è§†å™¨æ˜¯ï¼šå½“å‰ç±»æœ¬èº«

```java
//åŒæ­¥æ–¹æ³•ï¼Œå¤„ç†å®ç°Runnableæ¥å£çš„æ–¹å¼çš„çº¿ç¨‹å®‰å…¨é—®é¢˜
class Window implements Runnable{

    private  int ticket = 100;

    @Override
    public void run() {
        while (true) {
            show();
            if (ticket<=0){
                break;
            }
        }
    }
    private synchronized void show() {
        if (ticket > 0) {
            System.out.println(
                Thread.currentThread().getName() + "å–ç¥¨ï¼šç¥¨å·ä¸º" + ticket);
            ticket--;
        }
    }
}
```



```java
//åŒæ­¥æ–¹æ³•ï¼Œå¤„ç†ä½¿ç”¨ç»§æ‰¿Threadç±»çš„æ–¹å¼çš„çº¿ç¨‹å®‰å…¨é—®é¢˜
class Window2 extends Thread {

    private static int ticket = 500;

    @Override
    public void run() {
        while (true) {
            show();
            if (ticket<=0){
                break;
            }
        }
    }
    //ä¸‹è¿°æ–¹å¼ä¸ºé™æ€æ–¹æ³•ï¼Œä¸å­˜åœ¨thisï¼ŒåŒæ­¥ç›‘è§†å™¨ä¸ºwindow2.classï¼Œå”¯ä¸€ï¼Œçº¿ç¨‹å®‰å…¨ã€‚
    private static synchronized void show(){
    //private synchronized void show(){
    //ä¸Šè¿°æ–¹å¼åŒæ­¥ç›‘è§†å™¨ä¹Ÿæ˜¯thisï¼Œä¸‰ä¸ªçº¿ç¨‹åˆ†åˆ«æœ‰äº†ä¸‰ä¸ªé”ï¼Œæ‰€ä»¥ä¸å®‰å…¨ã€‚éœ€è¦æ”¹æˆé™æ€çš„
        if (ticket>0){
            System.out.println(
                Thread.currentThread().getName() + "å–ç¥¨ï¼šç¥¨å·ä¸º" + ticket);
            ticket--;
        }
    }
}
```







## 3ã€æ­»é”

> ä¸åŒçš„çº¿ç¨‹åˆ†åˆ«å ç”¨å¯¹æ–¹éœ€è¦çš„èµ„æºä¸æ”¾å¼ƒï¼Œéƒ½åœ¨ç­‰å¯¹æ–¹æ”¾å¼ƒèµ„æºï¼Œå°±å½¢æˆäº†æ­»é”ã€‚
>
> å‡ºç°æ­»é”ä»¥åï¼Œä¸ä¼šå‡ºç°å¼‚å¸¸ï¼Œä¸ä¼šå‡ºç°æç¤ºï¼Œä½†æ˜¯æ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¼šå¤„äºé˜»å¡çŠ¶æ€ï¼Œæ— æ³•ç»§ç»­



```java
//æœ‰å¯èƒ½å‡ºç°æ­»é”ï¼Œæ¦‚ç‡è¾ƒä½
public class ThreadTest{
    public static void main(String[] args){
        StringBuffer s1 = new StringBuffer();
        StringBuffer s2 = new StringBuffer();
        
        //ç»§æ‰¿Threadç±»
        new Thread(){
            @Override
            public void run(){
                
                synchronized(s1){
                    s1.append("a");
                    s2.append("1");
                    
                    synchronized(s2){
                        s1.append("b");
                    	s2.append("2");
                        system.out.println(s1);
                        system.out.println(s2);
                    }
                }
            }
        }.start();
            
        //å®ç°Runnableæ¥å£
        new Thread(new Runnable(){       
                @Override
                public void run(){

                    synchronized(s2){
                        s1.append("c");
                        s2.append("3");

                        synchronized(s1){
                            s1.append("d");
                            s2.append("4");
                            system.out.println(s1);
                            system.out.println(s2);
                        }
                    }
                }
        	}
        ).start();      
    }
}
```



```java
//åŠ äº†sleepï¼Œå‡ºç°æ¦‚ç‡å˜é«˜
//å½“ä¸¤ä¸ªçº¿ç¨‹éƒ½é†’æ¥æ—¶ï¼Œäº’ç›¸æ¡ç€å¯¹æ–¹çš„åŒæ­¥èµ„æº
package day_06;

/**
 * @version:
 * @Auther: ä»»åš
 * @Date: 2021/01/29/17:34
 * @Description:
 */
public class DeadTest {
    public static void main(String[] args){
        StringBuffer s1 = new StringBuffer();
        StringBuffer s2 = new StringBuffer();

        //ç»§æ‰¿Threadç±»
        new Thread(){
            @Override
            public void run(){

                synchronized(s1){
                    s1.append("a");
                    s2.append("1");
                    try {
                        Thread.sleep(100);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }

                    synchronized(s2){
                        s1.append("b");
                        s2.append("2");
                        System.out.println(s1);
                        System.out.println(s2);
                    }
                }
            }
        }.start();
        //å®ç°Runnableæ¥å£
        new Thread(new Runnable(){
            @Override
            public void run(){

                synchronized(s2){
                    s1.append("c");
                    s2.append("3");
                    try {
                        Thread.sleep(100);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    
                    synchronized(s1){
                        s1.append("d");
                        s2.append("4");
                        System.out.println(s1);
                        System.out.println(s2);
                    }
                }
            }
        }
        ).start();
    }
}

```





## 4ã€Lockï¼ˆé”ï¼‰

> - ä»JDK5.0å¼€å§‹ï¼ŒJavaæä¾›äº†æ›´å¼ºå¤§çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶â€”â€”é€šè¿‡æ˜¾å¼å®šä¹‰åŒæ­¥é”å¯¹è±¡æ¥å®ç°åŒæ­¥ã€‚åŒæ­¥é”ä½¿ç”¨Lockå¯¹è±¡å……å½“
>
> - `java.util.concurrent.locks.Lock`æ¥å£æ˜¯æ§åˆ¶å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºè¿›è¡Œè®¿é—®çš„å·¥å…·ã€‚
>
>   é”æä¾›äº†å¯¹å…±äº«èµ„æºçš„ç‹¬å è®¿é—®ï¼Œæ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹Lockå¯¹è±¡åŠ é”ï¼Œçº¿ç¨‹åœ¨å¼€å§‹è®¿é—®å…±äº«èµ„æºä¹‹å‰åº”å…ˆè·å¾—Lockå¯¹è±¡
>
> - `ReentrantLock`ç±»å®ç°äº†Lockï¼Œå®ƒæ‹¥æœ‰å’Œ`synchronized`ç›¸åŒçš„å¹¶å‘æ€§å’Œå†…å­˜è¯­ä¹‰ã€‚
>
>   åœ¨å®ç°çº¿ç¨‹å®‰å…¨çš„æ§åˆ¶ä¸­ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯`ReentrantLock`ï¼Œå¯ä»¥æ˜¾ç¤ºåŠ é”ã€é‡Šæ”¾é”ã€‚
>   
> - Lockåªæœ‰ä»£ç å—é”



```java
package day_06;

import java.util.concurrent.locks.ReentrantLock;

/**
 * @version:
 * @Auther: ä»»åš
 * @Date: 2021/03/08/16:10
 * @Description:
 */
public class LockTest {
    public static void main(String[] args) {
        Window w = new Window();
        Thread t1 = new Thread(w);
        Thread t2 = new Thread(w);
        Thread t3 = new Thread(w);

        t1.setName("çª—å£1");
        t2.setName("çª—å£2");
        t3.setName("çª—å£3");

        t1.start();
        t2.start();
        t3.start();
    }
}

class Window implements Runnable{

    private int ticket = 100;
    //1.å®ä¾‹åŒ–ReentrantLock
    private ReentrantLock lock = new ReentrantLock();

    @Override
    public void run() {
        while (true){
            try {
                //3.è°ƒç”¨é”å®šæ–¹æ³•lockï¼Œç›¸å½“äºè¢«é”ä½äº†
                lock.lock();
                //2.æŠŠè¿è¡Œä»£ç æ”¾åˆ°ä¸€ä¸ªtryé‡Œé¢
                if (ticket > 0) {
                    //ä¸ºäº†ä½¿é‡ç¥¨/é”™ç¥¨æ¦‚ç‡å¤§ï¼ŒåŠ äº†sleep
                    try {
                        Thread.sleep(100);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    System.out.println(Thread.currentThread().getName() + "å”®ç¥¨ï¼Œç¥¨å·ä¸º" + ticket);
                    ticket--;
                } else {
                    break;
                }
            }finally {
                //4.è°ƒç”¨è§£é”æ–¹æ³•unlock
                lock.unlock();
            }
        }
    }
}
```





# å››ã€çº¿ç¨‹çš„é€šä¿¡



æ¶‰åŠåˆ°ä¸‰ä¸ªæ–¹æ³•

- `wait()`ï¼šä¸€æ—¦æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¹¶é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨ï¼ˆé”ï¼‰

- `notify()`ï¼šä¸€æ—¦æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå°±ä¼šå”¤é†’è¢«`wait`çš„ä¸€ä¸ªçº¿ç¨‹ã€‚

  â€‹					å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è¢«`wait`ï¼Œå°±ä¼šå”¤é†’ä¼˜å…ˆçº§é«˜çš„é‚£ä¸€ä¸ªã€‚

- `notifyAll()`ï¼šä¸€æ—¦æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå°±ä¼šå”¤é†’æ‰€æœ‰è¢«`wait`çš„ä¸€ä¸ªçº¿ç¨‹ã€‚

è¯´æ˜ï¼š

- `wait()`ã€`notify()`ã€`notifyAll()`è¿™ä¸‰ä¸ªæ–¹æ³•å¿…é¡»ä½¿ç”¨åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­ã€‚

  - å³åªèƒ½ä½¿ç”¨åœ¨synchronizedä¸­ã€‚

  - lockè¿›è¡Œçº¿ç¨‹çš„é€šä¿¡æœ‰å…¶ä»–çš„æ–¹å¼ã€‚

- `wait()`ã€`notify()`ã€`notifyAll()`è¿™ä¸‰ä¸ªæ–¹æ³•çš„è°ƒç”¨è€…ï¼Œå¿…é¡»æ˜¯åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­çš„åŒæ­¥ç›‘è§†å™¨ã€‚

  å¦åˆ™ä¼šå‡ºç°`IllegalMonitorStateException`å¼‚å¸¸

- `wait()`ã€`notify()`ã€`notifyAll()`è¿™ä¸‰ä¸ªæ–¹æ³•æ˜¯å®šä¹‰åœ¨`java.lang.Object`ä¸­ã€‚

  åŒæ­¥ç›‘è§†å™¨ä»»ä½•ä¸€ä¸ªç±»çš„å¯¹è±¡éƒ½å¯ä»¥å……å½“ï¼Œæ‰€ä»¥ä»»ä½•ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥è°ƒç”¨ä¸‰ä¸ªæ–¹æ³•ã€‚

```java
package day_06;

/**
 * @version:
 * @Auther: ä»»åš
 * @Date: 2021/03/10/11:41
 * @Description:çº¿ç¨‹é€šä¿¡çš„ä¾‹å­:ä½¿ä¸¤ä¸ªçº¿ç¨‹æ‰“å°1-100ï¼Œçº¿ç¨‹ä¸€ã€çº¿ç¨‹äºŒäº¤æ›¿æ‰“å°
 */

class Number implements Runnable{

    private int number =1;
	//private Object obj = new Object();
    
    @Override
    public void run() {
        while (true){
            synchronized (this){               
            //synchronized (obj){
                
                //notify();//æŠ¥é”™ï¼Œnotify();ç›¸å½“äºthis.notify();
                		   //æ­¤æ—¶notifyçš„è°ƒç”¨è€…ä¸æ˜¯åŒæ­¥ç›‘è§†å™¨obj
                
                //å”¤é†’å¦ä¸€ä¸ªwaitçš„çº¿ç¨‹
                notify();
                
                if (number<=100){
                    System.out.println(Thread.currentThread().getName()+':'+number);
                    number++;
                }else {
                    break;
                }
                //ä½¿å¾—è°ƒç”¨ä»¥ä¸‹waitçš„çº¿ç¨‹ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€
                //æ‰§è¡Œwaitä¼šé‡Šæ”¾é”
                try {
                    wait();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }
    }
}

public class CommunicationTest {
    public static void main(String[] args) {

        Number number = new Number();
        Thread t1 = new Thread(number);
        Thread t2 = new Thread(number);

        t1.setName("çº¿ç¨‹ä¸€");
        t2.setName("çº¿ç¨‹äºŒ");

        t1.start();
        t2.start();
    }
}

```















































# EX-1 çº¿ç¨‹çš„åˆ†ç±»

Java çš„çº¿ç¨‹åˆ†ä¸ºä¸¤ç±»ï¼šä¸€ç±»æ˜¯**å®ˆæŠ¤çº¿ç¨‹**ï¼Œä¸€ç±»æ˜¯**ç”¨æˆ·çº¿ç¨‹**

- å®ƒä»¬å‡ ä¹æ¯ä¸ªæ–¹é¢éƒ½æ˜¯ç›¸åŒçš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯åˆ¤æ–­`JVM`ä½•æ—¶ç¦»å¼€

- **å®ˆæŠ¤çº¿ç¨‹**æ˜¯ç”¨æ¥æœåŠ¡**ç”¨æˆ·çº¿ç¨‹**çš„ï¼Œ

  é€šè¿‡åœ¨`start()`æ–¹æ³•å‰è°ƒç”¨`thread.setDaemon(true)`å¯ä»¥æŠŠä¸€ä¸ª**ç”¨æˆ·çº¿ç¨‹**å˜ä¸º**å®ˆæŠ¤çº¿ç¨‹**

- Javaçš„åƒåœ¾å›æ”¶å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å®ˆæŠ¤çº¿ç¨‹

- è‹¥`JVM`ä¸­éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå½“å‰`JVM`å°†é€€å‡º



# é¢è¯•é¢˜



## Javaä¸­çš„sleep()å’Œwait()çš„åŒºåˆ«

- è¿™ä¸¤ä¸ªæ–¹æ³•æ¥è‡ªä¸åŒçš„ç±»åˆ†åˆ«æ˜¯`Thread`å’Œ`Object` 
- æœ€ä¸»è¦æ˜¯`sleep`æ–¹æ³•æ²¡æœ‰é‡Šæ”¾é”ï¼Œè€Œ`wait`æ–¹æ³•é‡Šæ”¾äº†é”ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹å¯ä»¥ä½¿ç”¨åŒæ­¥æ§åˆ¶å—æˆ–è€…æ–¹æ³•(é”ä»£ç å—å’Œæ–¹æ³•é”)ã€‚
- `wait`ï¼Œ`notify`å’Œ`notifyAll`åªèƒ½åœ¨åŒæ­¥æ§åˆ¶æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—é‡Œé¢ä½¿ç”¨ï¼Œè€Œsleepå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨(ä½¿ç”¨èŒƒå›´) 
- sleepå¿…é¡»æ•è·å¼‚å¸¸ï¼Œè€Œ`wait`ï¼Œ`notify`å’Œ`notifyAll`ä¸éœ€è¦æ•è·å¼‚å¸¸ 

```java
public class TestD {
    public static void main(String[] args) {
        new Thread(new Thread1()).start();
        try {
            Thread.sleep(5000);
        } catch (Exception e) {
            e.printStackTrace();
        }
        new Thread(new Thread2()).start();
    }

    private static class Thread1 implements Runnable{
        @Override
        public void run(){
            synchronized (TestD.class) {
                System.out.println("enter thread1...");
                System.out.println("thread1 is waiting...");
                try {
                    //è°ƒç”¨wait()æ–¹æ³•ï¼Œçº¿ç¨‹ä¼šæ”¾å¼ƒå¯¹è±¡é”ï¼Œè¿›å…¥ç­‰å¾…æ­¤å¯¹è±¡çš„ç­‰å¾…é”å®šæ± 
                    TestD.class.wait();
                } catch (Exception e) {
                    e.printStackTrace();
                }
                System.out.println("thread1 is going on ....");
                System.out.println("thread1 is over!!!");
            }
        }
    }

    private static class Thread2 implements Runnable{
        @Override
        public void run(){
            synchronized (TestD.class) {
                System.out.println("enter thread2....");
                System.out.println("thread2 is sleep....");
                try {
                    //åœ¨è°ƒç”¨sleep()æ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ã€‚
                    Thread.sleep(5000);
                } catch (Exception e) {
                    e.printStackTrace();
                }
                System.out.println("thread2 is going on....");
                System.out.println("thread2 is over!!!");
                //å¦‚æœæˆ‘ä»¬æŠŠä»£ç ï¼šTestD.class.notify();ç»™æ³¨é‡Šæ‰ï¼Œ
                //å³TestD.classè°ƒç”¨äº†wait()æ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰è°ƒç”¨notify()
                //æ–¹æ³•ï¼Œåˆ™çº¿ç¨‹æ°¸è¿œå¤„äºæŒ‚èµ·çŠ¶æ€ã€‚
                TestD.class.notify();
            }
        }
    }
}

```



## Sychronizedå’ŒLockçš„å¼‚åŒ



ç›¸åŒï¼šéƒ½å¯ä»¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜

ä¸åŒï¼š

- Synchronizedæ˜¯éšå¼é”ï¼Œæœºåˆ¶åœ¨æ‰§è¡Œå®Œç›¸åº”çš„åŒæ­¥ä»£ç åï¼Œè‡ªåŠ¨é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨ã€‚
- Synchronizedæœ‰ä»£ç å—é”å’Œæ–¹æ³•é”



- Lockæ˜¯æ˜¾å¼é”ï¼Œéœ€è¦æ‰‹åŠ¨çš„å¯åŠ¨åŒæ­¥`lock()`ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æ‰‹åŠ¨çš„ç»“æŸåŒæ­¥`unlock()`
- Lockåªæœ‰ä»£ç å—é”
- ä½¿ç”¨Locké”ï¼ŒJVMå°†èŠ±è´¹æ›´å°‘çš„æ—¶é—´è°ƒåº¦çº¿ç¨‹ï¼Œæ€§èƒ½æ›´å¥½ã€‚å¹¶ä¸”å…·æœ‰æ›´å¥½çš„æ‰©å±•æ€§ï¼ˆæä¾›æ›´å¤šçš„å­ç±»ï¼‰



 **æ¨èä½¿ç”¨é¡ºåº**

> Lock 	ğŸ‘‰	åŒæ­¥ä»£ç å—ï¼ˆå·²ç»è¿›å…¥äº†æ–¹æ³•ä½“ï¼Œåˆ†é…äº†ç›¸åº”èµ„æºï¼‰ğŸ‘‰	åŒæ­¥æ–¹æ³•ï¼ˆåœ¨æ–¹æ³•ä½“å¤–ï¼‰



å¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨ï¼Œæœ‰å‡ ç§æ–¹å¼ï¼Ÿâ€”â€”ä¸‰ç§ï¼ˆä¸Šè¿°ï¼‰





## Sleepå’Œwaitçš„åŒºåˆ«

ç›¸åŒç‚¹ï¼šä¸€æ—¦æ‰§è¡Œï¼Œéƒ½å¯ä»¥ä½¿å½“å‰çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€

ä¸åŒç‚¹ï¼š

- æ–¹æ³•å®šä¹‰ä½ç½®ä¸ä¸€æ ·ã€‚

  - sleep()å®šä¹‰åœ¨Threadç±»ä¸­
  - wait()å®šä¹‰åœ¨Objectç±»ä¸­

- è°ƒç”¨çš„ è¦æ±‚ä¸ä¸€æ ·ã€‚

  - sleep()å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„åœºæ™¯ä¸‹è°ƒç”¨
  - wait()å¿…é¡»åœ¨åŒæ­¥ä»£ç å—æˆ–è€…åŒæ­¥æ–¹æ³•ä¸­è°ƒç”¨

- å…³äºæ˜¯å¦é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨ã€‚

  å¦‚æœä¸¤ä¸ªæ–¹æ³•éƒ½ä½¿ç”¨åœ¨åŒæ­¥ä»£ç å—æˆ–è€…åŒæ­¥æ–¹æ³•ä¸­

  - sleep()ä¸ä¼šé‡Šæ”¾é”
  - wait()ä¼šé‡Šæ”¾é”




## ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜

```java
package day_06;

//æœ¬è§£å†³æ–¹å¼ä¸ºå•æ¶ˆè´¹è€…å•ç”Ÿäº§è€…ï¼Œä¸”ååˆ†ç®€æ˜“ï¼Œ

/**
 * @version:
 * @Auther: ä»»åš
 * @Date: 2021/03/10/18:01
 * @Description:    çº¿ç¨‹é€šä¿¡ç»å…¸é—®é¢˜:ç”Ÿäº§è€…/æ¶ˆè´¹è€…é—®é¢˜
 * é—®é¢˜åˆ†æï¼š
 * 1ã€æ˜¯å¦æ˜¯å¤šçº¿ç¨‹é—®é¢˜ï¼Ÿæ˜¯ï¼Œç”Ÿäº§è€…çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹
 * 2ã€æ˜¯å¦æœ‰å…±äº«æ•°æ®ï¼Ÿæ˜¯ï¼Œäº§å“
 * 3ã€å¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿä¸‰ç§æ–¹æ³•
 * 4ã€æ˜¯å¦æ¶‰åŠåˆ°çº¿ç¨‹é€šä¿¡ï¼Ÿæ˜¯
 */

class Clerk{

    private int productNum = 0;
//    private ReentrantLock lock = new ReentrantLock();
    //ç”Ÿäº§è€…ç”Ÿäº§äº§å“
    public synchronized void produceProduct() {
        if (productNum<20){
            productNum++;
            System.out.println(Thread.currentThread().getName()+"å¼€å§‹ç”Ÿäº§ç¬¬"+productNum+"ä¸ªäº§å“");
            notify();
        }else {
            try {
                wait();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
    //æ¶ˆè´¹è€…æ¶ˆè´¹äº§å“
    public synchronized void consumeProduct() {
        if (productNum>0){
            System.out.println(Thread.currentThread().getName()+"å¼€å§‹æ¶ˆè´¹ç¬¬"+productNum+"ä¸ªäº§å“");
            productNum--;
            notify();
        }else {
            try {
                wait();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}

class Producer extends Thread{
    private Clerk clerk;

    public Producer(Clerk clerk){
        this.clerk=clerk;
    }

    @Override
    public void run() {
        System.out.println(Thread.currentThread().getName()+"å¼€å§‹ç”Ÿäº§............");

        try {
            Thread.sleep(100);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        while (true){
            clerk.produceProduct();
        }
    }
}

class Consumer extends Thread{
    private Clerk clerk;

    public Consumer(Clerk clerk){
        this.clerk=clerk;
    }

    @Override
    public void run() {
        try {
            Thread.sleep(100);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        while (true){
            clerk.consumeProduct();
        }
    }
}


public class ProductTest {
    public static void main(String[] args) {
        Clerk clerk = new Clerk();

        Producer p1 = new Producer(clerk);
        p1.setName("ç”Ÿäº§è€…ä¸€å·");

        Consumer c1 = new Consumer(clerk);
        c1.setName("æ¶ˆè´¹è€…ä¸€å·");

        p1.start();
        c1.start();
    }
}

```

